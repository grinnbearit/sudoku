(ns sudoku.core-test
  (:require [midje.sweet :refer :all]
            [sudoku.core :refer :all]))


(def solvable-problem
  ;; via https://en.wikipedia.org/wiki/Sudoku
  [[ 5   3  nil nil  7  nil nil nil nil]
   [ 6  nil nil  1   9   5  nil nil nil]
   [nil  9   8  nil nil nil nil  6  nil]
   [ 8  nil nil nil  6  nil nil nil  3 ]
   [ 4  nil nil  8  nil  3  nil nil  1 ]
   [ 7  nil nil nil  2  nil nil nil  6 ]
   [nil  6  nil nil nil nil  2   8  nil]
   [nil nil nil  4   1   9  nil nil  5 ]
   [nil nil nil nil  8  nil nil  7   9 ]])


(def unsolvable-problem
  ;; via http://www.sudokudragon.com/unsolvable.htm
  [[ 5   1   6   8   4   9   7   3   2 ]
   [ 3  nil  7   6  nil  5  nil nil nil]
   [ 8  nil  9   7  nil nil nil  6   5 ]
   [ 1   3   5  nil  6  nil  9  nil  7 ]
   [ 4   7   2   5   9   1  nil nil  6 ]
   [ 9   6   8   3   7  nil nil  5  nil]
   [ 2   5   3   1   8   6  nil  7   4 ]
   [ 6   8   4   2  nil  7   5  nil nil]
   [ 7   9   1  nil  5  nil  6  nil  8 ]])


(facts
 "problem -> constraints"

 (problem->constraints solvable-problem)
 => [[#{5 3 7} #{6 1 9 5} #{9 8 6} #{8 6 3} #{4 8 3 1} #{7 2 6} #{6 2 8} #{4 1 9 5} #{8 7 9}]
     [#{5 6 8 4 7} #{3 9 6} #{8} #{1 8 4} #{7 9 6 2 1 8} #{5 3 9} #{2} #{6 8 7} #{3 1 6 5 9}]
     [[#{5 3 6 9 8} #{7 1 9 5} #{6}]
      [#{8 4 7} #{6 8 3 2} #{3 1 6}]
      [#{6} #{4 1 9 8} #{2 8 5 7 9}]]
     [[0 2] [0 3] [0 5] [0 6] [0 7] [0 8]
      [1 1] [1 2] [1 6] [1 7] [1 8]
      [2 0] [2 3] [2 4] [2 5] [2 6] [2 8]
      [3 1] [3 2] [3 3] [3 5] [3 6] [3 7]
      [4 1] [4 2] [4 4] [4 6] [4 7]
      [5 1] [5 2] [5 3] [5 5] [5 6] [5 7]
      [6 0] [6 2] [6 3] [6 4] [6 5] [6 8]
      [7 0] [7 1] [7 2] [7 6] [7 7]
      [8 0] [8 1] [8 2] [8 3] [8 5] [8 6]]])


(facts
 "solve"

 (solve [#{5 3 7} #{6 1 9 5} #{9 8 6} #{8 6 3} #{4 8 3 1} #{7 2 6} #{6 2 8} #{4 1 9 5} #{8 7 9}]
        [#{5 6 8 4 7} #{3 9 6} #{8} #{1 8 4} #{7 9 6 2 1 8} #{5 3 9} #{2} #{6 8 7} #{3 1 6 5 9}]
        [[#{5 3 6 9 8} #{7 1 9 5} #{6}]
         [#{8 4 7} #{6 8 3 2} #{3 1 6}]
         [#{6} #{4 1 9 8} #{2 8 5 7 9}]]
        [[0 2] [0 3] [0 5] [0 6] [0 7] [0 8]
         [1 1] [1 2] [1 6] [1 7] [1 8]
         [2 0] [2 3] [2 4] [2 5] [2 6] [2 8]
         [3 1] [3 2] [3 3] [3 5] [3 6] [3 7]
         [4 1] [4 2] [4 4] [4 6] [4 7]
         [5 1] [5 2] [5 3] [5 5] [5 6] [5 7]
         [6 0] [6 2] [6 3] [6 4] [6 5] [6 8]
         [7 0] [7 1] [7 2] [7 6] [7 7]
         [8 0] [8 1] [8 2] [8 3] [8 5] [8 6]])

 => [[0 2 4] [0 3 6] [0 5 8] [0 6 9] [0 7 1] [0 8 2]
     [1 1 7] [1 2 2] [1 6 3] [1 7 4] [1 8 8]
     [2 0 1] [2 3 3] [2 4 4] [2 5 2] [2 6 5] [2 8 7]
     [3 1 5] [3 2 9] [3 3 7] [3 5 1] [3 6 4] [3 7 2]
     [4 1 2] [4 2 6] [4 4 5] [4 6 7] [4 7 9]
     [5 1 1] [5 2 3] [5 3 9] [5 5 4] [5 6 8] [5 7 5]
     [6 0 9] [6 2 1] [6 3 5] [6 4 3] [6 5 7] [6 8 4]
     [7 0 2] [7 1 8] [7 2 7] [7 6 6] [7 7 3]
     [8 0 3] [8 1 4] [8 2 5] [8 3 2] [8 5 6] [8 6 1]])


(facts
 "fill blanks"

 (fill-blanks solvable-problem
              [[0 2 4] [0 3 6] [0 5 8] [0 6 9] [0 7 1] [0 8 2]
               [1 1 7] [1 2 2] [1 6 3] [1 7 4] [1 8 8]
               [2 0 1] [2 3 3] [2 4 4] [2 5 2] [2 6 5] [2 8 7]
               [3 1 5] [3 2 9] [3 3 7] [3 5 1] [3 6 4] [3 7 2]
               [4 1 2] [4 2 6] [4 4 5] [4 6 7] [4 7 9]
               [5 1 1] [5 2 3] [5 3 9] [5 5 4] [5 6 8] [5 7 5]
               [6 0 9] [6 2 1] [6 3 5] [6 4 3] [6 5 7] [6 8 4]
               [7 0 2] [7 1 8] [7 2 7] [7 6 6] [7 7 3]
               [8 0 3] [8 1 4] [8 2 5] [8 3 2] [8 5 6] [8 6 1]])

 => [[5 3 4 6 7 8 9 1 2]
     [6 7 2 1 9 5 3 4 8]
     [1 9 8 3 4 2 5 6 7]
     [8 5 9 7 6 1 4 2 3]
     [4 2 6 8 5 3 7 9 1]
     [7 1 3 9 2 4 8 5 6]
     [9 6 1 5 3 7 2 8 4]
     [2 8 7 4 1 9 6 3 5]
     [3 4 5 2 8 6 1 7 9]])


(facts
 "sudoku"

 (sudoku solvable-problem)

 => [[5 3 4 6 7 8 9 1 2]
     [6 7 2 1 9 5 3 4 8]
     [1 9 8 3 4 2 5 6 7]
     [8 5 9 7 6 1 4 2 3]
     [4 2 6 8 5 3 7 9 1]
     [7 1 3 9 2 4 8 5 6]
     [9 6 1 5 3 7 2 8 4]
     [2 8 7 4 1 9 6 3 5]
     [3 4 5 2 8 6 1 7 9]]


 (sudoku unsolvable-problem)
 => nil)
